<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>RFC 7690 - Close Encounters of the ICMP Type 2 Kind (Near Misses with ICMPv6 Packet Too Big (PTB)) 日本語訳</title>
  <meta name="description" content="RFC 7690は、ICMPv6パケットが大きすぎる場合の近接ミスに関するものであり、その目的は、ネットワークのパフォーマンスと信頼性を向上させるために、ICMPv6 PTBメッセージの処理方法を改善することです。">
  
  <link rel="shortcut icon" type="image/x-icon" href="https://tex2e.github.io/rfc-translater/favicon.ico" />
  <link rel="stylesheet" href="./bootstrap/css/bootstrap.min.css">
  <link rel="stylesheet" href="./master.css">
  <script src="./index.js"></script>

</head>
<body>
  
  <nav class="navbar navbar-expand navbar-light bg-light">
    <a class="navbar-brand" href="index.html">RFC Trans</a>
    <div class="collapse navbar-collapse" id="navbarText">
      <div class="navbar-nav mr-auto">
        <a class="nav-item nav-link" href="draft/index.html">Draft</a>
        <a class="nav-item nav-link" href="contact.html">Contact</a>
        <a class="nav-item nav-link" href="../figs/html/index.html">Figs</a>
      </div>
      <div class="navbar-nav ml-auto">
        <span class="navbar-text"><small>@tex2e</small></span>
      </div>
    </div>
  </nav>

  <span id="rfc_number" class="hidden">7690</span>
  <div style="height: 1ex;"></div>
  <div class="jump-to-original-rfc-container">
    <a href="https://datatracker.ietf.org/doc/html/rfc7690">
      <button type="button" class="btn btn-light btn-sm">
        <span class="jump-to-original-rfc">Orig</span>
      </button>
    </a>
  </div>
  <div class="container">
    <div>
      <div class="alert alert-info" role="alert">
        <h4 class="alert-heading">RFC 7690 - Close Encounters of the ICMP Type 2 Kind (Near Misses with ICMPv6 Packet Too Big (PTB)) 日本語訳</h4>
        <span class="URL">原文URL :
          <a href="https://datatracker.ietf.org/doc/html/rfc7690">
            https://datatracker.ietf.org/doc/html/rfc7690
          </a>
        </span><br>
        <span class="title_ja">
          タイトル : <strong>RFC 7690 - ICMPタイプ2の種類の接近（ICMPv6パケットが大きすぎる（PTB）でのニアミス）</strong></span><br>
        <span class="updated_by">翻訳編集 : 自動生成</span><span id="rfc_status"></span><span id="rfc_wg"></span><br>
      </div>
      <div id="rfc_alert" class="hidden" role="alert">
        <div class="alert alert-danger">
          <span id="rfc_alert_obsoleted_by"></span>
        </div>
      </div>
    </div>
    <div id="rfc_summary">
      <div class="card mb-3">
        <div class="card-body">
          <p class="card-text">[要約] RFC 7690は、ICMPv6パケットが大きすぎる場合の近接ミスに関するものであり、その目的は、ネットワークのパフォーマンスと信頼性を向上させるために、ICMPv6 PTBメッセージの処理方法を改善することです。</p>
        </div>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-12">
        <pre class="text text-monospace">
Internet Engineering Task Force (IETF)                         M. Byerly
Request for Comments: 7690                                        Fastly
Category: Informational                                          M. Hite
ISSN: 2070-1721                                                 Evernote
                                                              J. Jaeggli
                                                                  Fastly
                                                            January 2016
        </pre>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <p class="text indent-13">
 Close Encounters of the ICMP Type 2 Kind (Near Misses with ICMPv6 Packet Too Big (PTB))
        </p>
      </div>
      <div class="col-sm-12 col-md-6">
        <p class="text indent-13">
ICMPタイプ2の種類の接近（ICMPv6パケットが大きすぎる（PTB）でのニアミス）
        </p>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <p class="text indent-0">
Abstract
        </p>
      </div>
      <div class="col-sm-12 col-md-6">
        <p class="text indent-0">
概要
        </p>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
This document calls attention to the problem of delivering ICMPv6 type 2 &#34;Packet Too Big&#34; (PTB) messages to the intended destination (typically the server) in ECMP load-balanced or anycast network architectures. It discusses operational mitigations that can be employed to address this class of failures.
        </p>
      </div>
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
このドキュメントでは、ECMPv6タイプ2の &#34;Packet Too Big&#34;（PTB）メッセージを目的の宛先（通常はサーバー）にECMP負荷分散またはエニーキャストネットワークアーキテクチャで配信する際の問題に注意を向けています。このクラスの障害に対処するために使用できる運用上の軽減策について説明します。
        </p>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <p class="text indent-0">
Status of This Memo
        </p>
      </div>
      <div class="col-sm-12 col-md-6">
        <p class="text indent-0">
本文書の状態
        </p>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
This document is not an Internet Standards Track specification; it is published for informational purposes.
        </p>
      </div>
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
このドキュメントはInternet Standards Trackの仕様ではありません。情報提供を目的として公開されています。
        </p>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
This document is a product of the Internet Engineering Task Force (IETF). It represents the consensus of the IETF community. It has received public review and has been approved for publication by the Internet Engineering Steering Group (IESG). Not all documents approved by the IESG are a candidate for any level of Internet Standard; see Section 2 of RFC 5741.
        </p>
      </div>
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
このドキュメントは、IETF（Internet Engineering Task Force）の製品です。これは、IETFコミュニティのコンセンサスを表しています。公開レビューを受け、インターネットエンジニアリングステアリンググループ（IESG）による公開が承認されました。 IESGによって承認されたすべてのドキュメントが、あらゆるレベルのインターネット標準の候補になるわけではありません。 RFC 5741のセクション2をご覧ください。
        </p>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
Information about the current status of this document, any errata, and how to provide feedback on it may be obtained at http://www.rfc-editor.org/info/rfc7690.
        </p>
      </div>
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
このドキュメントの現在のステータス、エラータ、およびフィードバックの提供方法に関する情報は、http：//www.rfc-editor.org/info/rfc7690で入手できます。
        </p>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <p class="text indent-0">
Copyright Notice
        </p>
      </div>
      <div class="col-sm-12 col-md-6">
        <p class="text indent-0">
著作権表示
        </p>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
Copyright (c) 2016 IETF Trust and the persons identified as the document authors. All rights reserved.
        </p>
      </div>
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
Copyright（c）2016 IETF Trustおよびドキュメントの作成者として識別された人物。全著作権所有。
        </p>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
This document is subject to BCP 78 and the IETF Trust&#39;s Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document. Please review these documents carefully, as they describe your rights and restrictions with respect to this document. Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.
        </p>
      </div>
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
この文書は、BCP 78およびIETF文書に関するIETFトラストの法的規定（http://trustee.ietf.org/license-info）の対象であり、この文書の発行日に有効です。これらのドキュメントは、このドキュメントに関するあなたの権利と制限を説明しているため、注意深く確認してください。このドキュメントから抽出されたコードコンポーネントには、Trust Legal Provisionsのセクション4.eに記載されているSimplified BSD Licenseのテキストが含まれている必要があり、Simplified BSD Licenseに記載されているように保証なしで提供されます。
        </p>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <p class="text indent-0">
Table of Contents
        </p>
      </div>
      <div class="col-sm-12 col-md-6">
        <p class="text indent-0">
目次
        </p>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-12">
        <pre class="text text-monospace toc">
   1.  Introduction  . . . . . . . . . . . . . . . . . . . . . . . .   2
   2.  Problem . . . . . . . . . . . . . . . . . . . . . . . . . . .   3
   3.  Mitigation  . . . . . . . . . . . . . . . . . . . . . . . . .   4
     3.1.  Alternative Mitigations . . . . . . . . . . . . . . . . .   5
     3.2.  Implementation  . . . . . . . . . . . . . . . . . . . . .   5
       3.2.1.  Alternative Implementation  . . . . . . . . . . . . .   6
   4.  Improvements  . . . . . . . . . . . . . . . . . . . . . . . .   7
   5.  Security Considerations . . . . . . . . . . . . . . . . . . .   8
   6.  Informative References  . . . . . . . . . . . . . . . . . . .   8
   Acknowledgements  . . . . . . . . . . . . . . . . . . . . . . . .   9
   Authors&#39; Addresses  . . . . . . . . . . . . . . . . . . . . . . .   9
        </pre>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <h5 class="text mt-2" id="1--Introduction">
1. Introduction
        </h5>
      </div>
      <div class="col-sm-12 col-md-6">
        <h5 class="text mt-2">
1. はじめに
        </h5>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
Operators of popular Internet services face complex challenges associated with scaling their infrastructure. One scaling approach is to utilize equal-cost multipath (ECMP) routing to perform stateless distribution of incoming TCP or UDP sessions to multiple servers or to middle boxes such as load balancers. Distribution of traffic in this manner presents a problem when dealing with ICMP signaling. Specifically, an ICMP error is not guaranteed to hash via ECMP to the same destination as its corresponding TCP or UDP session. A case where this is particularly problematic operationally is path MTU discovery (PMTUD) [RFC1981].
        </p>
      </div>
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
一般的なインターネットサービスの運営者は、インフラストラクチャの拡張に関連する複雑な課題に直面しています。 1つのスケーリングアプローチは、等コストマルチパス（ECMP）ルーティングを利用して、着信TCPまたはUDPセッションを複数のサーバーまたはロードバランサーなどのミドルボックスにステートレスに配布することです。この方法でトラフィックを分散すると、ICMPシグナリングを処理するときに問題が発生します。具体的には、ICMPエラーは、対応するTCPまたはUDPセッションと同じ宛先にECMPを介してハッシュされることが保証されていません。これが運用上特に問題となるケースは、パスMTU発見（PMTUD）[RFC1981]です。
        </p>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <h5 class="text mt-2" id="2--Problem">
2. Problem
        </h5>
      </div>
      <div class="col-sm-12 col-md-6">
        <h5 class="text mt-2">
2. 問題
        </h5>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
A common application for stateless load balancing of TCP or UDP flows is to perform an initial subdivision of flows in front of a stateful load-balancer tier or multiple servers so that the workload becomes divided into manageable fractions of the total number of flows. The flow division is performed using ECMP forwarding and a stateless but sticky algorithm for hashing across the available paths (see [RFC2991] for background on ECMP routing). For the purposes of flow distribution, this next-hop selection is a constrained form of anycast topology, where all anycast destinations are equidistant from the upstream router responsible for making the last next-hop forwarding decision before the flow arrives on the destination device. In this approach, the hash is performed across some set of available protocol headers. Typically, these headers may include all or a subset of (IPv6) Flow-Label, IP-source, IP-destination, protocol, source-port, destination-port, and potentially others such as ingress interface.
        </p>
      </div>
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
TCPまたはUDPフローのステートレスロードバランシングの一般的なアプリケーションは、ステートフルロードバランサー層または複数のサーバーの前でフローの最初のサブディビジョンを実行して、ワークロードがフローの総数の管理可能な割合に分割されるようにすることです。フロー分割は、ECMPフォワーディングと、利用可能なパス全体でハッシュするためのステートレスでスティッキーアルゴリズムを使用して実行されます（ECMPルーティングの背景については[RFC2991]を参照してください）。フロー分散の目的で、このネクストホップの選択はエニーキャストトポロジーの制約された形式であり、すべてのエニーキャスト宛先は、フローが宛先デバイスに到着する前に最後のネクストホップ転送の決定を行う上流ルーターから等距離にあります。このアプローチでは、利用可能なプロトコルヘッダーのセット全体でハッシュが実行されます。通常、これらのヘッダーには、（IPv6）フローラベル、IP送信元、IP宛先、プロトコル、送信元ポート、宛先ポート、および場合によっては入力インターフェイスなどのすべてまたは一部が含まれます。
        </p>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
A problem common to this approach of distribution through hashing is impact on path MTU discovery. An ICMPv6 type 2 PTB message generated on an intermediate device for a packet sent from a server that is part of an ECMP load-balanced service to a client will have the load-balanced anycast address as the destination and hence will be statelessly load balanced to one of the servers. While the ICMPv6 PTB message contains as much of the packet that could not be forwarded as possible, the payload headers are not considered in the forwarding decision and are ignored. Because the PTB message is not identifiable as part of the original flow by the IP or upper-layer packet headers, the results of the ICMPv6 ECMP hash calculation are unlikely to be hashed to the same next hop as packets matching the TCP or UDP ECMP hash of the flow.
        </p>
      </div>
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
ハッシュによる分散のこのアプローチに共通する問題は、パスMTU検出への影響です。 ECMP負荷分散サービスの一部であるサーバーからクライアントに送信されたパケットの中間デバイスで生成されたICMPv6タイプ2 PTBメッセージは、宛先として負荷分散されたエニーキャストアドレスを持ち、ステートレスに負荷分散されます。サーバーの1つ。 ICMPv6 PTBメッセージには、転送できなかったパケットができるだけ多く含まれていますが、ペイロードヘッダーは転送の決定では考慮されず、無視されます。 PTBメッセージは、IPまたは上位層のパケットヘッダーによって元のフローの一部として識別できないため、ICMPv6 ECMPハッシュ計算の結果は、TCPまたはUDP ECMPハッシュに一致するパケットと同じネクストホップにハッシュされる可能性は低い流れの。
        </p>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
An example packet flow and topology follow. The packet for which the PTB message was generated was intended for the client.
        </p>
      </div>
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
次に、パケットフローとトポロジの例を示します。 PTBメッセージが生成されたパケットは、クライアント向けでした。
        </p>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-12">
        <pre class="text text-monospace">
   ptb -&gt; router ecmp -&gt; next hop L4/L7 load balancer -&gt; destination
        </pre>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-12">
        <pre class="text text-monospace">
     router --&gt; load balancer 1 ---&gt;
          \\--&gt; load balancer 2 ---&gt; load-balanced service
           \--&gt; load balancer N ---&gt;
        </pre>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <p class="text indent-33">
Figure 1
        </p>
      </div>
      <div class="col-sm-12 col-md-6">
        <p class="text indent-33">
図1
        </p>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
The router ECMP decision is used because it is part of the forwarding architecture, can be performed at line rate, and does not depend on shared state or coordination across a distributed forwarding system that may include multiple linecards or routers. The ECMP routing decision is deterministic with respect to packets having the same computed hash.
        </p>
      </div>
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
ルータECMP決定は、転送アーキテクチャの一部であり、ラインレートで実行でき、複数のラインカードまたはルータを含む可能性のある分散転送システム全体の共有状態または調整に依存しないために使用されます。 ECMPルーティングの決定は、同じ計算されたハッシュを持つパケットに関して決定的です。
        </p>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
A typical case in which ICMPv6 PTB messages are received at the load balancer is where the path MTU from the client to the load balancer is limited by a tunnel of which the client itself is not aware.
        </p>
      </div>
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
ICMPv6 PTBメッセージがロードバランサーで受信される典型的なケースは、クライアントからロードバランサーへのパスMTUが、クライアント自体が認識していないトンネルによって制限される場合です。
        </p>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
Direct experience says that the frequency of PTB messages is small compared to total flows. One possible conclusion is that tunneled IPv6 deployments that cannot carry 1500 MTU packets are relatively rare. Techniques employed by clients (e.g., Happy Eyeballs [RFC6555]) may actually contribute some amelioration to the IPv6 client experience by preferring IPv4 in cases that might be identified as failures. Still, the expectation of operators is that PMTUD should work and that unnecessary breakage of client traffic should be avoided.
        </p>
      </div>
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
直接的な経験によれば、PTBメッセージの頻度はフロー全体に比べて小さいとされています。考えられる結論の1つは、1500 MTUパケットを伝送できないトンネル化されたIPv6展開は比較的まれであるということです。クライアントで採用されている手法（たとえば、Happy Eyeballs [RFC6555]）は、障害として識別される可能性がある場合にIPv4を優先することにより、IPv6クライアントエクスペリエンスの改善に実際に貢献する場合があります。それでも、オペレーターの期待は、PMTUDが機能し、クライアントトラフィックの不要な破損が回避されることです。
        </p>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
A final observation regarding server tuning is that it is not always possible, even if it is potentially desirable to be able to independently set the TCP MSS (Maximum Segment Size) for different address families on some end systems. On Linux platforms, advmss (advertised mss) may be set on a per-route basis for selected destinations in cases where discrimination by route is possible.
        </p>
      </div>
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
サーバーのチューニングに関する最後の観察は、一部のエンドシステムで異なるアドレスファミリに対してTCP MSS（最大セグメントサイズ）を個別に設定できることが望ましい場合でも、常に可能であるとは限らないということです。 Linuxプラットフォームでは、ルートによる識別が可能な場合に、選択した宛先に対してルートごとにadvmss（アドバタイズされたmss）を設定できます。
        </p>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
The problem as described does also impact IPv4; however, implementation of RFC 4821 [RFC4821] TCP MTU probing, the ability to fragment on the wire at tunnel ingress points, and the relative rarity of sub-1500-byte MTUs that are not coupled to changes in client behavior (for example, endpoint VPN clients set the tunnel interface MTU accordingly to avoid fragmentation for performance reasons) makes the problem sufficiently rare that some existing deployments have chosen to ignore it.
        </p>
      </div>
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
説明した問題はIPv4にも影響します。ただし、RFC 4821 [RFC4821]の実装、TCP MTUプローブ、トンネル入力ポイントでのワイヤのフラグメント化機能、およびクライアントの動作の変更に関連付けられていない1500バイト未満のMTUの希少性​​（エンドポイントなど） VPNクライアントは、パフォーマンス上の理由で断片化を回避するためにトンネルインターフェイスMTUを適宜設定します）、既存の一部の展開では無視するように選択されているため、問題は非常にまれです。
        </p>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <h5 class="text mt-2" id="3--Mitigation">
3. Mitigation
        </h5>
      </div>
      <div class="col-sm-12 col-md-6">
        <h5 class="text mt-2">
3. 緩和
        </h5>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <p class="text indent-0">
 Mitigation of the potential for PTB messages to be misdelivered involves ensuring that an ICMPv6 error message is distributed to the same anycast server responsible for the flow for which the error is generated. With appropriate hardware support, flows could be identified using the same technique as hosts by inspecting the payload of the ICMPv6 message. The ECMP hash calculation can then be performed using values identified from the inner TCP flow parameters of the ICMPv6 message. Because the encapsulated IP header occurs at a fixed offset in the ICMP message, it is not outside the realm of possibility that routers with sufficient header processing capability could parse that far into the payload. Employing a mediation device that handles the parsing and distribution of PTB messages after policy routing or on each load balancer / server is a possibility.
        </p>
      </div>
      <div class="col-sm-12 col-md-6">
        <p class="text indent-0">
PTBメッセージが誤って配信される可能性の軽減には、ICMPv6エラーメッセージが、エラーが生成されたフローを担当する同じエニーキャストサーバーに配信されるようにすることが含まれます。適切なハードウェアサポートがあれば、ICMPv6メッセージのペイロードを検査することにより、ホストと同じ手法を使用してフローを識別できます。次に、ICMPv6メッセージの内部TCPフローパラメータから識別された値を使用して、ECMPハッシュ計算を実行できます。カプセル化されたIPヘッダーはICMPメッセージの固定オフセットで発生するため、十分なヘッダー処理機能を備えたルーターがその範囲までペイロードを解析できる可能性の範囲外ではありません。ポリシールーティング後または各ロードバランサー/サーバーでPTBメッセージの解析と配信を処理するメディエーションデバイスを使用することは可能です。
        </p>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
Another mitigation approach is predicated upon distributing the PTB message to all anycast servers under the assumption that the one for which the message was intended will be able to match it to the flow and update the route cache with the new MTU and that devices not able to match the flow will discard these packets. Such distribution has potentially significant implications for resource consumption and for self-inflicted denial of service (DOS) if not carefully employed. Fortunately, we have observed that the number of flows for which this problem occurs is relatively small in real-world deployments (for example, 10 or fewer pps on 1 Gbit/s or more worth of HTTPS); sensible ingress rate limiters that will discard excessive message volume can be applied to protect even very large anycast server tiers with the potential for fallout limited to circumstances of deliberate duress.
        </p>
      </div>
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
別の緩和策は、メッセージが意図されたものがフローと一致し、ルートキャッシュを新しいMTUで更新できること、およびデバイスがそれを実行できないことを前提として、すべてのエニーキャストサーバーにPTBメッセージを配信することを前提としています。フローと一致すると、これらのパケットが破棄されます。このような配布は、注意深く使用しないと、リソースの消費と自己申告によるサービス拒否（DOS）に重大な影響を与える可能性があります。幸いにも、この問題が発生するフローの数は、実際の展開では比較的少ないことがわかっています（たとえば、1 Gbps以上のHTTPSで10 pp以下）。過剰なメッセージ量を破棄する賢明なイングレスレートリミッターを適用して、非常に大規模なエニーキャストサーバー層を保護することもできます。
        </p>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <h5 class="text mt-2" id="3-1--Alternative-Mitigations">
3.1. Alternative Mitigations
        </h5>
      </div>
      <div class="col-sm-12 col-md-6">
        <h5 class="text mt-2">
3.1. 代替の緩和策
        </h5>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
As an alternative, it may be appropriate to lower the TCP MSS to 1220 in order to accommodate 1280-byte MTU. We consider this undesirable, as hosts may not be able to independently set TCP MSS by address family thereby impacting IPv4, or alternatively that middle-boxes need to be employed to clamp the MSS independently from the end systems. Potentially, extension headers might further alter the lower bound that the MSS would have to be set to, making clamping even more undesirable.
        </p>
      </div>
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
別の方法として、1280バイトのMTUに対応するために、TCP MSSを1220に下げることが適切な場合があります。ホストはアドレスファミリによってTCP MSSを個別に設定できず、IPv4に影響を与える可能性があるため、またはMSDをエンドシステムから独立してクランプするためにミドルボックスを使用する必要があるため、これは望ましくないと考えています。潜在的に、拡張ヘッダーは、MSSを設定する必要がある下限をさらに変更し、クランプをさらに望ましくないものにする可能性があります。
        </p>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <h5 class="text mt-2" id="3-2--Implementation">
3.2. Implementation
        </h5>
      </div>
      <div class="col-sm-12 col-md-6">
        <h5 class="text mt-2">
3.2. 実装
        </h5>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
1. Filter-based forwarding matches next-header ICMPv6 type 2 and matches a next hop on a particular subnet directly attached to one or more routers. The filter is policed to reasonable limits (we chose 1000 pps; more conservative rates might be required in other implementations).
        </p>
      </div>
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
1. フィルターベースの転送は、ネクストヘッダーICMPv6タイプ2に一致し、1つ以上のルーターに直接接続されている特定のサブネット上のネクストホップに一致します。フィルターは適切な制限にポリシングされます（1000 ppsを選択しました。他の実装ではより保守的なレートが必要になる場合があります）。
        </p>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
2. The filter is applied on the input side of all external (Internet- or customer-facing) interfaces.
        </p>
      </div>
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
2. フィルターは、すべての外部（インターネットまたは顧客向け）インターフェースの入力側に適用されます。
        </p>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
3. A proxy located at the next hop forwards ICMPv6 type 2 packets it receives to an Ethernet broadcast address (example ff:ff:ff:ff:ff:ff) on all specified subnets. This was necessitated by router inability (in IPv6) to forward the same packet to multiple unicast next hops.
        </p>
      </div>
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
3. ネクストホップにあるプロキシは、受信したICMPv6タイプ2パケットを、指定されたすべてのサブネット上のイーサネットブロードキャストアドレス（例：ff：ff：ff：ff：ff：ff）に転送します。これは、ルーターが（IPv6で）同じパケットを複数のユニキャストネクストホップに転送できないために必要でした。
        </p>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
4. Anycasted servers receive the PTB error and process the packet as needed.
        </p>
      </div>
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
4. エニーキャストサーバーはPTBエラーを受け取り、必要に応じてパケットを処理します。
        </p>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
A simple Python scapy [SCAPY] script that can perform the ICMPv6 proxy reflection is included.
        </p>
      </div>
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
ICMPv6プロキシリフレクションを実行できる単純なPython scapy [SCAPY]スクリプトが含まれています。
        </p>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-12">
        <pre class="text text-monospace">
         #!/usr/bin/python
        </pre>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <p class="text indent-9">
from scapy.all import *
        </p>
      </div>
      <div class="col-sm-12 col-md-6">
        <p class="text indent-9">
scapy.allインポートから*
        </p>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-12">
        <pre class="text text-monospace">
         IFACE_OUT = [&#34;p2p1&#34;, &#34;p2p2&#34;]
        </pre>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-12">
        <pre class="text text-monospace">
         def icmp6_callback(pkt):
             if pkt.haslayer(IPv6) and (ICMPv6PacketTooBig in pkt) \
             and pkt[Ether].dst != &#39;ff:ff:ff:ff:ff:ff&#39;:
                 del(pkt[Ether].src)
                 pkt[Ether].dst = &#39;ff:ff:ff:ff:ff:ff&#39;
                 pkt.show()
                 for iface in IFACE_OUT:
                     sendp(pkt, iface=iface)
        </pre>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-12">
        <pre class="text text-monospace">
         def main():
             sniff(prn=icmp6_callback, filter=&#34;icmp6 \
             and (ip6[40+0] == 2)&#34;, store=0)
        </pre>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-12">
        <pre class="text text-monospace">
         if __name__ == &#39;__main__&#39;:
             main()
        </pre>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
This example script listens on all interfaces for IPv6 PTB errors being forwarded using filter-based forwarding. It removes the existing Ethernet source and rewrites a new Ethernet destination of the Ethernet broadcast address. It then sends the resulting frame out the p2p1 and p2p2 interfaces that are attached to VLANs where our anycast servers reside.
        </p>
      </div>
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
このスクリプト例は、フィルターベースの転送を使用して転送されるIPv6 PTBエラーをすべてのインターフェイスでリッスンします。既存のイーサネットソースを削除し、イーサネットブロードキャストアドレスの新しいイーサネット宛先を書き換えます。次に、結果のフレームを、エニーキャストサーバーが存在するVLANに接続されているp2p1およびp2p2インターフェイスに送信します。
        </p>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <h5 class="text mt-2" id="3-2-1--Alternative-Implementation">
3.2.1. Alternative Implementation
        </h5>
      </div>
      <div class="col-sm-12 col-md-6">
        <h5 class="text mt-2">
3.2.1. 代替実装
        </h5>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
Alternatively, network designs in which a common layer 2 network exists on the ECMP hop could distribute the proxy onto the end systems, eliminating the need for policy routing. They could then rewrite the destination -- for example, using iptables before forwarding the packet back to the network containing all of the server or load-balancer interfaces. This implementation can be done entirely within the Linux iptables firewall. Because of the distributed nature of the filter, more conservative rate limits are required than when a global rate limit can be employed.
        </p>
      </div>
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
あるいは、ECMPホップ上に共通のレイヤー2ネットワークが存在するネットワーク設計では、プロキシをエンドシステムに配布して、ポリシールーティングの必要をなくすことができます。次に、たとえばiptablesを使用して宛先を書き換え、パケットをすべてのサーバーまたはロードバランサーインターフェイスを含むネットワークに転送します。この実装は、完全にLinux iptablesファイアウォール内で行うことができます。フィルターの性質が分散しているため、グローバルなレート制限を使用できる場合よりも、より保守的なレート制限が必要です。
        </p>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
An example ip6tables/nftables rule to match icmp6 traffic, not match broadcast traffic, impose a rate limit of 10 pps, and pass to a target destination would resemble:
        </p>
      </div>
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
icmp6トラフィックに一致し、ブロードキャストトラフィックには一致せず、10 ppsのレート制限を課し、ターゲットの宛先に渡すip6tables / nftablesルールの例は、次のようになります。
        </p>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-12">
        <pre class="text text-monospace">
       ip6tables -I INPUT -i lo -p icmpv6 -m icmpv6 --icmpv6-type 2/0 \
       -m pkttype ! --pkt-type broadcast -m limit --limit 10/second \
       -j TEE 2001:DB8::1
        </pre>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
As with the scapy example, once the destination has been rewritten from a hardcoded ND entry to an Ethernet broadcast address -- in this case to an IPv6 documentation address -- the traffic will be reflected to all the hosts on the subnet.
        </p>
      </div>
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
scapyの例と同様に、宛先がハードコードされたNDエントリからイーサネットブロードキャストアドレス（この場合はIPv6ドキュメントアドレス）に書き換えられると、トラフィックはサブネット上のすべてのホストに反映されます。
        </p>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <h5 class="text mt-2" id="4--Improvements">
4. Improvements
        </h5>
      </div>
      <div class="col-sm-12 col-md-6">
        <h5 class="text mt-2">
4. 改善点
        </h5>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
There are several ways that improvements could be made to improve handling ECMP load balancing of ICMPv6 PTB messages. Little in the way of change to the Internet protocol specification is required; rather, we foresee practical implementation change, which, insofar as we are aware, does not exist in current router, switch, or layer 3/4 load balancers. Alternatively, improved behavior on the part of client/server detection of path MTU in band could render the behavior of devices in the path irrelevant.
        </p>
      </div>
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
ICMPv6 PTBメッセージのECMPロードバランシングの処理を改善するために改善を行うことができるいくつかの方法があります。インターネットプロトコル仕様の変更はほとんど必要ありません。むしろ、実際の実装の変更を予測しています。これは、私たちが知る限り、現在のルーター、スイッチ、またはレイヤー3/4ロードバランサーには存在しません。または、帯域内のパスMTUのクライアント/サーバー検出の動作が改善されたため、パス内のデバイスの動作が無関係になる可能性があります。
        </p>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
1. Routers with sufficient capacity within the lookup process could parse all the way through the L3 or L4 header in the ICMPv6 payload beginning at bit offset 32 of the ICMP header. By reordering the elements of the hash to match the inward direction of the flow, the PTB error could be directed to the same next hop as the incoming packets in the flow.
        </p>
      </div>
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
1. ルックアッププロセス内に十分な容量があるルーターは、ICMPv6ペイロードのL3またはL4ヘッダーを介して、ICMPヘッダーのビットオフセット32で始まるすべてを解析できます。ハッシュの要素をフローの内側方向に一致するように並べ替えることにより、PTBエラーはフロー内の着信パケットと同じネクストホップに送られる可能性があります。
        </p>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
2. The FIB (Forwarding Information Base) on the router could be programmed with a multicast distribution tree that includes all of the necessary next hops, and unicast ICMPv6 packets could be policy routed to these destinations.
        </p>
      </div>
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
2. ルータ上のFIB（Forwarding Information Base）は、必要なすべてのネクストホップを含むマルチキャスト配信ツリーでプログラムでき、ユニキャストICMPv6パケットはこれらの宛先にポリシールーティングできます。
        </p>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
3. Ubiquitous implementation of RFC 4821 [RFC4821] Packetization Layer Path MTU Discovery would probably go a long way towards reducing dependence on ICMPv6 PTB by end systems.
        </p>
      </div>
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
3. RFC 4821 [RFC4821]のユビキタス実装は、パケット化レイヤパスMTUディスカバリは、エンドシステムによるICMPv6 PTBへの依存を減らすのにおそらく長い道のりを行くでしょう。
        </p>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <h5 class="text mt-2" id="5--Security-Considerations">
5. Security Considerations
        </h5>
      </div>
      <div class="col-sm-12 col-md-6">
        <h5 class="text mt-2">
5. セキュリティに関する考慮事項
        </h5>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
The employed mitigation has the potential to greatly amplify the impact of a deliberately malicious sending of ICMPv6 PTB messages. Sensible ingress rate limiting can reduce the potential for impact; legitimate PMTUD messages may be lost once the rate limit is reached. The scenario where drops of legitimate traffic occur is analogous to other cases where DOS traffic can crowd out legitimate traffic, however only a limited subset of overall traffic is impacted.
        </p>
      </div>
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
採用された緩和策は、ICMPv6 PTBメッセージの意図的な悪意のある送信の影響を大幅に拡大する可能性があります。賢明な進入レート制限は、影響の可能性を減らすことができます。レート制限に達すると、正当なPMTUDメッセージが失われる可能性があります。正当なトラフィックのドロップが発生するシナリオは、DOSトラフィックが正当なトラフィックを混雑させる可能性がある他のケースに類似していますが、影響を受けるのは全体的なトラフィックの限られたサブセットのみです。
        </p>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
The proxy replication results in all devices on the subnet receiving ICMPv6 PTB errors, even those not associated with the flow. This could arguably result in information disclosure due to the wide replication of the ICMPv6 PTB error on the subnet and the large fragment of the offending IP packet embedded in the ICMPv6 error. Because of this, recipient machines should be in a common administrative domain.
        </p>
      </div>
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
プロキシ複製の結果、フローに関連付けられていないデバイスであっても、サブネット上のすべてのデバイスがICMPv6 PTBエラーを受け取ります。これにより、サブネットでのICMPv6 PTBエラーの幅広い複製と、ICMPv6エラーに埋め込まれた問題のIPパケットの大きなフラグメントにより、情報漏えいが発生する可能性があります。このため、受信側のマシンは共通の管理ドメインにある必要があります。
        </p>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <h5 class="text mt-2" id="6--Informative-References">
6. Informative References
        </h5>
      </div>
      <div class="col-sm-12 col-md-6">
        <h5 class="text mt-2">
6. 参考引用
        </h5>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
[RFC1981] McCann, J., Deering, S., and J. Mogul, &#34;Path MTU Discovery for IP version 6&#34;, RFC 1981, DOI 10.17487/RFC1981, August 1996, &lt;http://www.rfc-editor.org/info/rfc1981&gt;.
        </p>
      </div>
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
[RFC1981] McCann、J.、Deering、S。、およびJ. Mogul、「Path MTU Discovery for IP version 6」、RFC 1981、DOI 10.17487 / RFC1981、1996年8月、&lt;http：//www.rfc-editor。 org / info / rfc1981&gt;。
        </p>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
[RFC2991] Thaler, D. and C. Hopps, &#34;Multipath Issues in Unicast and Multicast Next-Hop Selection&#34;, RFC 2991, DOI 10.17487/RFC2991, November 2000, &lt;http://www.rfc-editor.org/info/rfc2991&gt;.
        </p>
      </div>
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
[RFC2991] Thaler、D。およびC. Hopps、「ユニキャストおよびマルチキャストネクストホップ選択におけるマルチパスの問題」、RFC 2991、DOI 10.17487 / RFC2991、2000年11月、&lt;http://www.rfc-editor.org/info / rfc2991&gt;。
        </p>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
[RFC4821] Mathis, M. and J. Heffner, &#34;Packetization Layer Path MTU Discovery&#34;, RFC 4821, DOI 10.17487/RFC4821, March 2007, &lt;http://www.rfc-editor.org/info/rfc4821&gt;.
        </p>
      </div>
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
[RFC4821] Mathis、M。およびJ. Heffner、「Packetization Layer Path MTU Discovery」、RFC 4821、DOI 10.17487 / RFC4821、2007年3月、&lt;http://www.rfc-editor.org/info/rfc4821&gt;。
        </p>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
[RFC6555] Wing, D. and A. Yourtchenko, &#34;Happy Eyeballs: Success with Dual-Stack Hosts&#34;, RFC 6555, DOI 10.17487/RFC6555, April 2012, &lt;http://www.rfc-editor.org/info/rfc6555&gt;.
        </p>
      </div>
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
[RFC6555] Wing、D.、A。Yourtchenko、「Happy Eyeballs：Success with Dual-Stack Hosts」、RFC 6555、DOI 10.17487 / RFC6555、2012年4月、&lt;http://www.rfc-editor.org/info/ rfc6555&gt;。
        </p>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
[SCAPY] Scapy, &lt;http://www.secdev.org/projects/scapy/&gt;.
        </p>
      </div>
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
[SCAPY] Scapy、&lt;http://www.secdev.org/projects/scapy/&gt;。
        </p>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <p class="text indent-0">
Acknowledgements
        </p>
      </div>
      <div class="col-sm-12 col-md-6">
        <p class="text indent-0">
謝辞
        </p>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
The authors thank Marak Majkowsiki for contributing text, examples, and a very thorough review. The authors would like to thank Mark Andrews, Brian Carpenter, Nick Hilliard, and Ray Hunter, for review.
        </p>
      </div>
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
著者は、テキスト、例、および非常に徹底的なレビューを提供してくれたMarak Majkowsikiに感謝します。著者はレビューのためにマーク・アンドリュース、ブライアン・カーペンター、ニック・ヒリアード、レイ・ハンターに感謝したいと思います。
        </p>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <p class="text indent-0">
Authors&#39; Addresses
        </p>
      </div>
      <div class="col-sm-12 col-md-6">
        <p class="text indent-0">
著者のアドレス
        </p>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
Matt Byerly Fastly Kapolei, HI United States
        </p>
      </div>
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
Matt Byerly Fastlyカポレイ、ハワイ州アメリカ合衆国
        </p>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-12">
        <pre class="text text-monospace">
   Email: suckawha@gmail.com
        </pre>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
Matt Hite Evernote Redwood City, CA United States
        </p>
      </div>
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
Matt Hite Evernote Redwood City、CAアメリカ合衆国
        </p>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-12">
        <pre class="text text-monospace">
   Email: mhite@hotmail.com
        </pre>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
Joel Jaeggli Fastly Mountain View, CA United States
        </p>
      </div>
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
Joel Jaeggli Fastly Mountain View、CAアメリカ合衆国
        </p>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-12">
        <pre class="text text-monospace">
   Email: joelja@gmail.com
        </pre>
      </div>
    </div>
  </div>
  <div id="rfc_footer"></div>
</body>
</html>
