version: "3"
services:

  # Selenium サーバを起動するコンテナ
  selenium:
    container_name: rfctrans-selenium-chrome
    # restart: unless-stopped
    # 通常の環境では、以下のイメージを使います。
    #image: selenium/standalone-chrome
    # M1 Mac など ARM で動作する環境では、以下のイメージを使います。
    #image: seleniarm/standalone-chromium
    image: ${DOCKER_SELENIUM_IMAGE_NAME}
    ports:
      # Selenium サーバに接続するポート
      - "4444:4444"
      # VNC で接続するポート
      - "5900:5900"
      # Selenium サーバのログを出力するポート
      - "7900:7900"
    # コンテナが使用するメモリの上限を設定
    shm_size: "2gb"

  # Web スクレイピングを実行するコンテナ
  scraping-app:
    container_name: rfctrans-python
    # restart: unless-stopped
    build:
      context: ./
      dockerfile: ./Dockerfile
    volumes:
      - ./main.py:/opt/app/main.py
      - ./src:/opt/app/src
      - ./tests:/opt/app/tests
      - ./templates:/opt/app/templates
      - ./data:/opt/app/data
      - ./html:/opt/app/html
      - ./secrets/docker/.env:/opt/app/.env
    tty: true
